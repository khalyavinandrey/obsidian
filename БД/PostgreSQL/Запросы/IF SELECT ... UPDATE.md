такое нельзя делать
![[Pasted image 20241118205800.png]]

потому что данные в промежутке от проверки до апдейта могут поменяться

например корзина товаров - нашел товар, нажал оплатить, а потом товар уже закончился

в таком случае можно придумать с insert on conflict
пользовательские блокировки
[[Pessimistic Locking]]

#бд 
#postgresql 

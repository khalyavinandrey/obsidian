для того чтобы оценить эффективность разных планов выполнения этого запроса, оптимизатору требуется вычислить их стоимость

план 1: full scan - зная количество страниц, которое занимает таблица, оптимизатор может рассчитать - сколько раз нужно будет обратиться к диску, чтобы считать все требуемые страницы
план 2: с индексом - оптимизатор оценит количество извлекаемых записей, взятой из [[Статистика]], взяв глубину индекса и составив пропорцию из количества выбранных записей, общего количества записей и количество листовых блоков - рассчитает количество прочитанных индексных страниц, затем, приняв во внимание фактор кластеризации индекса - приблизительно вычислит количество страниц, которое надо будет просмотреть для извлечения искомых строк

стоимость остальных узлов плана оценивается так же, как и стоимость поиска: оценивается количество и размер строк, поступающих из дочерних узлов

в результате сравнения планов получили набор операций, которые будут выполнены при реализации плана и оценку количества этих операций, для получения стоимости набора операций осталось умножить количество операций на цену операции
<u>(в postgresql это константы - которые при желании можно изменить)</u>

после того как физический план построен - начинается исполнение запроса

однако нужно понимать, что стоимость построенного плана дает лишь примерное представление о времени выполнения запроса, но на время так же влияет и текущее состояние базы данных - например, сколько раз нужно будет читать данные с диска? а может данные лежат в кэше? - но для такого тоже есть метрика cache hit ratio

[[4 параметра, влияющие на скорость выполнения запроса]]

#бд 